2025-11-20 16:28:05,062 - __main__ - INFO - ====================================================================================================
2025-11-20 16:28:05,062 - __main__ - INFO - ğŸš€ TEST END-TO-END - NUTRICIÃ“N INICIAL (N0-N8)
2025-11-20 16:28:05,062 - __main__ - INFO - ====================================================================================================
2025-11-20 16:28:05,062 - __main__ - INFO - 
2025-11-20 16:28:05,062 - __main__ - INFO - ğŸ“‹ PASO 1: Cargando client_context con training completo...
2025-11-20 16:28:05,062 - __main__ - INFO - âœ… client_context cargado correctamente
2025-11-20 16:28:05,062 - __main__ - INFO -    - Cliente: client_juan_perez_e2e
2025-11-20 16:28:05,062 - __main__ - INFO -    - Snapshot: snapshot_client_juan_perez_e2e_1_f5e4abe8
2025-11-20 16:28:05,062 - __main__ - INFO -    - VersiÃ³n: 1
2025-11-20 16:28:05,062 - __main__ - INFO - âœ… training.bridge_for_nutrition detectado
2025-11-20 16:28:05,062 - __main__ - INFO - 
2025-11-20 16:28:05,062 - __main__ - INFO - ğŸ”§ PASO 2: Inicializando orchestrator...
2025-11-20 16:28:05,582 - edn360.orchestrator - INFO - âœ… Bases de conocimiento cargadas: Training KB (86468 chars), Nutrition KB (83355 chars)
2025-11-20 16:28:05,582 - __main__ - INFO - âœ… Orchestrator inicializado correctamente
2025-11-20 16:28:05,582 - __main__ - INFO -    - KB Nutrition: 83355 caracteres
2025-11-20 16:28:05,582 - __main__ - INFO - 
2025-11-20 16:28:05,582 - __main__ - INFO - âš™ï¸ PASO 3: Ejecutando flujo completo N0 â†’ N1 â†’ N2 â†’ N3 â†’ N4 â†’ N5 â†’ N6 â†’ N7 â†’ N8...
2025-11-20 16:28:05,582 - __main__ - INFO -    (Este proceso puede tomar varios minutos)
2025-11-20 16:28:05,582 - __main__ - INFO - 
2025-11-20 16:28:05,582 - edn360.orchestrator - INFO - ğŸ¥— EJECUTANDO PIPELINE DE NUTRICIÃ“N INDEPENDIENTE
2025-11-20 16:28:05,582 - edn360.orchestrator - INFO -    Client: client_juan_perez_e2e, Snapshot: snapshot_client_juan_perez_e2e_1_f5e4abe8
2025-11-20 16:28:05,582 - edn360.orchestrator - INFO -   ğŸ¥— INICIANDO PIPELINE DE NUTRICIÃ“N (N0-N8)
2025-11-20 16:28:05,582 - edn360.orchestrator - INFO -   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2025-11-20 16:28:05,582 - edn360.orchestrator - INFO -   âœ… training.bridge_for_nutrition detectado
2025-11-20 16:28:05,582 - edn360.orchestrator - INFO -   â–¶ï¸ Ejecutando N0 (Analista de Triaje Nutricional)...
2025-11-20 16:28:05,584 - edn360.orchestrator - INFO -     â„¹ï¸ N0 no recibe KB (optimizaciÃ³n de contexto)
2025-11-20 16:28:05,584 - edn360.agents.base_agent - INFO - ğŸ¤– N0 (Analista de Triaje Nutricional) - Iniciando ejecuciÃ³n
2025-11-20 16:30:56,914 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-20 16:30:56,919 - edn360.agents.base_agent - INFO - ğŸ“ N0 respuesta (primeros 500 chars): ```json
{
  "client_context": {
    "meta": {
      "client_id": "client_juan_perez_e2e",
      "snapshot_id": "snapshot_client_juan_perez_e2e_1_f5e4abe8",
      "version": 1,
      "selected_inputs": {
        "cuestionario": "unknown",
        "entrenamiento_base": null
      }
    },
    "raw_inputs": {
      "cuestionario_inicial": "{\n  \"client_id\": \"client_juan_perez_e2e\",\n  \"version\": 1,\n  \"timestamp\": \"2025-11-20T13:37:00.955160\",\n  \"nombre\": \"Juan PÃ©rez GarcÃ­a\",\n  \"ed
2025-11-20 16:30:56,919 - edn360.agents.base_agent - INFO - âœ… N0 completado en 171.34s
2025-11-20 16:30:56,919 - edn360.orchestrator - INFO -   âœ… N0 actualizÃ³ nutrition.* correctamente
2025-11-20 16:30:56,919 - edn360.orchestrator - INFO -     ğŸ” Validando contrato de N0...
2025-11-20 16:30:56,919 - edn360.orchestrator - INFO -   âœ… N0 completado y validado
2025-11-20 16:30:56,919 - edn360.orchestrator - INFO -   â–¶ï¸ Ejecutando N1 (Analista MetabÃ³lico)...
2025-11-20 16:30:56,919 - edn360.orchestrator - INFO -     ğŸ” Validando inputs requeridos: ['profile']
2025-11-20 16:30:56,920 - edn360.agents.base_agent - INFO - ğŸ¤– N1 (Analista MetabÃ³lico) - Iniciando ejecuciÃ³n
2025-11-20 16:30:56,920 - edn360.agents.base_agent - INFO - ğŸ“š N1 usando KB de 83355 caracteres
2025-11-20 16:31:01,782 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-20 16:31:01,783 - edn360.agents.base_agent - INFO - ğŸ“ N1 respuesta (primeros 500 chars): ```json
{
  "status": "ok",
  "perfil_metabolico": "compensado",
  "tdee_estimado": 2550,
  "bmr_estimado": 1831,
  "ta_aplicada": "-5%",
  "neat_factor": 1.05,
  "nivel_actividad": "entreno_4dias",
  "perfil_energetico": "equilibrado_B",
  "adherencia_fisiologica": 78,
  "riesgos": ["estres_3"],
  "banderas": [],
  "recomendaciones": [
    "No aplicar dÃ©ficit superior al -20%",
    "Controlar cortisol y progresiÃ³n de fuerza",
    "Aumentar NEAT a 9k pasos antes de recortar kcal"
  ],
  "transmi
2025-11-20 16:31:01,783 - edn360.agents.base_agent - WARNING - ğŸ” N1 devolviÃ³ formato antiguo. Normalizando...
2025-11-20 16:31:01,783 - edn360.agents.base_agent - INFO - âœ… N1 - Formato antiguo convertido a client_context.nutrition.metabolism
2025-11-20 16:31:01,783 - edn360.agents.base_agent - INFO - âœ… N1 completado en 4.86s
2025-11-20 16:31:01,783 - edn360.orchestrator - INFO -   âœ… N1 actualizÃ³ nutrition.* correctamente
2025-11-20 16:31:01,783 - edn360.orchestrator - INFO -     ğŸ” Validando contrato de N1...
2025-11-20 16:31:01,783 - edn360.orchestrator - INFO -   âœ… N1 completado y validado
2025-11-20 16:31:01,783 - edn360.orchestrator - INFO -   â–¶ï¸ Ejecutando N2 (Selector de Estrategia EnergÃ©tica)...
2025-11-20 16:31:01,784 - edn360.orchestrator - INFO -     ğŸ” Validando inputs requeridos: ['metabolism', 'profile']
2025-11-20 16:31:01,784 - edn360.agents.base_agent - INFO - ğŸ¤– N2 (Selector de Estrategia EnergÃ©tica) - Iniciando ejecuciÃ³n
2025-11-20 16:31:01,784 - edn360.agents.base_agent - INFO - ğŸ“š N2 usando KB de 83355 caracteres
2025-11-20 16:31:01,941 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-11-20 16:31:01,943 - openai._base_client - INFO - Retrying request to /chat/completions in 55.796000 seconds
2025-11-20 16:31:57,891 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-11-20 16:31:57,892 - openai._base_client - INFO - Retrying request to /chat/completions in 7.712000 seconds
2025-11-20 16:32:05,774 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-11-20 16:32:05,775 - edn360.agents.base_agent - ERROR - âŒ N2 fallÃ³: Error code: 429 - {'error': {'message': 'Rate limit reached for gpt-4o in organization org-EWRMz9dCMT0ktVNDPdFoICct on tokens per min (TPM): Limit 30000, Used 23119, Requested 27898. Please try again in 42.034s. Visit https://platform.openai.com/account/rate-limits to learn more.', 'type': 'tokens', 'param': None, 'code': 'rate_limit_exceeded'}}
2025-11-20 16:32:05,775 - edn360.orchestrator - ERROR -   âŒ N2 fallÃ³: Error code: 429 - {'error': {'message': 'Rate limit reached for gpt-4o in organization org-EWRMz9dCMT0ktVNDPdFoICct on tokens per min (TPM): Limit 30000, Used 23119, Requested 27898. Please try again in 42.034s. Visit https://platform.openai.com/account/rate-limits to learn more.', 'type': 'tokens', 'param': None, 'code': 'rate_limit_exceeded'}}
2025-11-20 16:32:05,775 - __main__ - ERROR - âŒ Flujo fallÃ³: N2 fallÃ³: Error code: 429 - {'error': {'message': 'Rate limit reached for gpt-4o in organization org-EWRMz9dCMT0ktVNDPdFoICct on tokens per min (TPM): Limit 30000, Used 23119, Requested 27898. Please try again in 42.034s. Visit https://platform.openai.com/account/rate-limits to learn more.', 'type': 'tokens', 'param': None, 'code': 'rate_limit_exceeded'}}
2025-11-20 16:32:05,775 - __main__ - ERROR -    Revisa los logs arriba para identificar en quÃ© agente fallÃ³
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         2025-11-20 16:28:23,164 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-20 16:28:23,171 - edn360.agents.base_agent - INFO - ğŸ“ N4 respuesta (primeros 500 chars): ```json
{
  "client_context": {
    "meta": {
      "client_id": "client_juan_perez_e2e",
      "snapshot_id": "snapshot_client_juan_perez_e2e_1_f5e4abe8",
      "version": 1,
      "selected_inputs": {
        "cuestionario": "unknown",
        "entrenamiento_base": null
      }
    },
    "raw_inputs": {
      "cuestionario_inicial": "{\n  \"client_id\": \"client_juan_perez_e2e\",\n  \"version\": 1,\n  \"timestamp\": \"2025-11-20T13:37:00.955160\",\n  \"nombre\": \"Juan PÃ©rez GarcÃ­a\",\n  \"ed
2025-11-20 16:28:23,171 - edn360.agents.base_agent - INFO - âœ… N4 completado en 77.46s
2025-11-20 16:28:23,172 - edn360.orchestrator - INFO -   âœ… N4 actualizÃ³ nutrition.* correctamente
2025-11-20 16:28:23,172 - edn360.orchestrator - INFO -     ğŸ” Validando contrato de N4...
2025-11-20 16:28:23,172 - edn360.orchestrator - INFO -   âœ… N4 completado y validado
2025-11-20 16:28:23,172 - edn360.orchestrator - INFO -   â–¶ï¸ Ejecutando N5 (Distribuidor de Timing)...
2025-11-20 16:28:23,172 - edn360.orchestrator - INFO -     ğŸ” Validando inputs requeridos: ['weekly_structure', 'macro_design']
2025-11-20 16:28:23,172 - edn360.orchestrator - INFO -     â„¹ï¸ N5 no recibe KB (optimizaciÃ³n de contexto)
2025-11-20 16:28:23,172 - edn360.agents.base_agent - INFO - ğŸ¤– N5 (Distribuidor de Timing) - Iniciando ejecuciÃ³n
2025-11-20 16:29:44,976 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-20 16:29:45,018 - edn360.agents.base_agent - INFO - ğŸ“ N5 respuesta (primeros 500 chars): ```json
{
  "client_context": {
    "meta": {
      "client_id": "client_juan_perez_e2e",
      "snapshot_id": "snapshot_client_juan_perez_e2e_1_f5e4abe8",
      "version": 1,
      "selected_inputs": {
        "cuestionario": "unknown",
        "entrenamiento_base": null
      }
    },
    "raw_inputs": {
      "cuestionario_inicial": "{\n  \"client_id\": \"client_juan_perez_e2e\",\n  \"version\": 1,\n  \"timestamp\": \"2025-11-20T13:37:00.955160\",\n  \"nombre\": \"Juan PÃ©rez GarcÃ­a\",\n  \"ed
2025-11-20 16:29:45,019 - edn360.agents.base_agent - INFO - âœ… N5 completado en 81.85s
2025-11-20 16:29:45,019 - edn360.orchestrator - INFO -   âœ… N5 actualizÃ³ nutrition.* correctamente
2025-11-20 16:29:45,019 - edn360.orchestrator - INFO -     ğŸ” Validando contrato de N5...
2025-11-20 16:29:45,019 - edn360.orchestrator - INFO -   âœ… N5 completado y validado
2025-11-20 16:29:45,019 - edn360.orchestrator - INFO -   â–¶ï¸ Ejecutando N6 (Generador de MenÃº)...
2025-11-20 16:29:45,019 - edn360.orchestrator - INFO -     ğŸ” Validando inputs requeridos: ['timing_plan', 'weekly_structure', 'macro_design', 'profile']
2025-11-20 16:29:45,020 - edn360.orchestrator - INFO -     â„¹ï¸ N6 no recibe KB (optimizaciÃ³n de contexto)
2025-11-20 16:29:45,020 - edn360.agents.base_agent - INFO - ğŸ¤– N6 (Generador de MenÃº) - Iniciando ejecuciÃ³n
2025-11-20 16:32:00,988 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-20 16:32:00,989 - edn360.agents.base_agent - INFO - ğŸ“ N6 respuesta (primeros 500 chars): ```json
{
  "client_context": {
    "meta": {
      "client_id": "client_juan_perez_e2e",
      "snapshot_id": "snapshot_client_juan_perez_e2e_1_f5e4abe8",
      "version": 1,
      "selected_inputs": {
        "cuestionario": "unknown",
        "entrenamiento_base": null
      }
    },
    "raw_inputs": {
      "cuestionario_inicial": "{\n  \"client_id\": \"client_juan_perez_e2e\",\n  \"version\": 1,\n  \"timestamp\": \"2025-11-20T13:37:00.955160\",\n  \"nombre\": \"Juan PÃ©rez GarcÃ­a\",\n  \"ed
2025-11-20 16:32:00,990 - edn360.agents.base_agent - INFO - âœ… N6 completado en 135.97s
2025-11-20 16:32:00,990 - edn360.orchestrator - INFO -   âœ… N6 actualizÃ³ nutrition.* correctamente
2025-11-20 16:32:00,990 - edn360.orchestrator - INFO -     ğŸ” Validando contrato de N6...
2025-11-20 16:32:00,990 - edn360.orchestrator - INFO -   âœ… N6 completado y validado
2025-11-20 16:32:00,990 - edn360.orchestrator - INFO -   â–¶ï¸ Ejecutando N7 (Coach de Adherencia)...
2025-11-20 16:32:00,991 - edn360.orchestrator - INFO -     ğŸ” Validando inputs requeridos: ['menu_plan', 'profile']
2025-11-20 16:32:00,991 - edn360.orchestrator - INFO -     â„¹ï¸ N7 no recibe KB (optimizaciÃ³n de contexto)
2025-11-20 16:32:00,991 - edn360.agents.base_agent - INFO - ğŸ¤– N7 (Coach de Adherencia) - Iniciando ejecuciÃ³n
2025-11-20 16:38:12,962 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-20 16:38:12,994 - edn360.agents.base_agent - INFO - ğŸ“ N7 respuesta (primeros 500 chars): ```json
{
  "client_context": {
    "meta": {
      "client_id": "client_juan_perez_e2e",
      "snapshot_id": "snapshot_client_juan_perez_e2e_1_f5e4abe8",
      "version": 1,
      "selected_inputs": {
        "cuestionario": "unknown",
        "entrenamiento_base": null
      }
    },
    "raw_inputs": {
      "cuestionario_inicial": "{\n  \"client_id\": \"client_juan_perez_e2e\",\n  \"version\": 1,\n  \"timestamp\": \"2025-11-20T13:37:00.955160\",\n  \"nombre\": \"Juan PÃ©rez GarcÃ­a\",\n  \"ed
2025-11-20 16:38:12,995 - edn360.agents.base_agent - INFO - âœ… N7 completado en 372.00s
2025-11-20 16:38:12,995 - edn360.orchestrator - INFO -   âœ… N7 actualizÃ³ nutrition.* correctamente
2025-11-20 16:38:12,995 - edn360.orchestrator - INFO -     ğŸ” Validando contrato de N7...
2025-11-20 16:38:12,995 - edn360.orchestrator - INFO -   âœ… N7 completado y validado
2025-11-20 16:38:12,995 - edn360.orchestrator - INFO -   â–¶ï¸ Ejecutando N8 (Watchdog de Seguridad Nutricional)...
2025-11-20 16:38:12,995 - edn360.orchestrator - INFO -     ğŸ” Validando inputs requeridos: ['menu_plan', 'macro_design', 'profile']
2025-11-20 16:38:12,996 - edn360.orchestrator - INFO -     â„¹ï¸ N8 no recibe KB (optimizaciÃ³n de contexto)
2025-11-20 16:38:12,996 - edn360.agents.base_agent - INFO - ğŸ¤– N8 (Watchdog de Seguridad Nutricional) - Iniciando ejecuciÃ³n
